<!DOCTYPE html>
<html>
<head>
    <title>3D Chemical Structures with Three.js</title>
    <meta charset="UTF-8">
    <style>
        body { 
            margin: 0; 
            font-family: Arial, sans-serif; 
            background-color: #f4f4f4; 
        }
        #page-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
        }
        #viewers-container { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            width: 95%; 
            max-width: 1200px; 
            gap: 20px;
        }
        .molecule-viewer {
            width: 500px;
            height: 500px;
            border: 1px solid #ccc;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
        }
        .viewer-title {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            background-color: #e9e9e9;
            border-bottom: 1px solid #ccc;
        }
        .canvas-wrapper {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
        }
        canvas { 
            display: block; 
            width: 100%;
            height: 100%;
        }
    </style>
    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls for mouse interaction -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="page-container">
        <h1>3D Chemical Structure Viewer (Three.js)</h1>
        <div id="viewers-container">
            <div class="molecule-viewer">
                <div class="viewer-title">Molecule 1: Substituted Cyclohexane (Chair)</div>
                <div class="canvas-wrapper" id="viewer1_canvas_container"></div>
            </div>
            <div class="molecule-viewer">
                <div class="viewer-title">Molecule 2: Tetramethyl-bis(methylidene)cyclohexane</div>
                <div class="canvas-wrapper" id="viewer2_canvas_container"></div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const ATOM_RADIUS = { 'C': 0.35, 'H': 0.20, 'DEFAULT': 0.3 };
        const ATOM_COLORS = {
            'C': 0x282828, // Dark Grey
            'H': 0xE0E0E0, // Light Grey
        };
        const BOND_RADIUS_SINGLE = 0.07;
        const BOND_RADIUS_DOUBLE = 0.11;
        const BOND_COLOR = 0x505050;

        // --- Helper Functions ---
        function createAtomMesh(element, position) {
            const radius = ATOM_RADIUS[element] || ATOM_RADIUS['DEFAULT'];
            const color = ATOM_COLORS[element] || 0x999999;
            const geometry = new THREE.SphereGeometry(radius, 16, 16);
            const material = new THREE.MeshPhongMaterial({ color: color, shininess: 50 });
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.set(position.x, position.y, position.z);
            return sphere;
        }

        function createBondMesh(pos1, pos2, order = 1) {
            const group = new THREE.Group();
            const direction = new THREE.Vector3().subVectors(pos2, pos1);
            const distance = direction.length();

            if (distance < 0.01) return group;

            const bondMaterial = new THREE.MeshPhongMaterial({ color: BOND_COLOR, shininess: 30 });
            const bondRadius = order === 2 ? BOND_RADIUS_DOUBLE : BOND_RADIUS_SINGLE;

            const cylinderGeometry = new THREE.CylinderGeometry(bondRadius, bondRadius, distance, 8);
            const cylinder = new THREE.Mesh(cylinderGeometry, bondMaterial);

            cylinder.position.copy(pos1).add(direction.multiplyScalar(0.5));
            cylinder.quaternion.setFromUnitVectors(
                new THREE.Vector3(0, 1, 0), 
                direction.clone().normalize()
            );

            group.add(cylinder);
            return group;
        }

        // --- Molecule Definitions ---
        const molecule1_atoms = [
            // Ring carbons
            { id: 'c1', el: 'C', pos: new THREE.Vector3(1.25, 0.00, 0.41) },
            { id: 'c2', el: 'C', pos: new THREE.Vector3(0.62, 1.08, -0.41) },
            { id: 'c3', el: 'C', pos: new THREE.Vector3(-0.62, 1.08, 0.41) },
            { id: 'c4', el: 'C', pos: new THREE.Vector3(-1.25, 0.00, -0.41) },
            { id: 'c5', el: 'C', pos: new THREE.Vector3(-0.62, -1.08, 0.41) },
            { id: 'c6', el: 'C', pos: new THREE.Vector3(0.62, -1.08, -0.41) },
            
            // Substituents
            { id: 'h1e', el: 'H', pos: new THREE.Vector3(1.85, 0.00, 1.11) },
            { id: 'me1a', el: 'C', pos: new THREE.Vector3(1.25, 0.00, -1.10) },
            { id: 'me2a', el: 'C', pos: new THREE.Vector3(0.62, 1.88, -1.11) },
            { id: 'me3a', el: 'C', pos: new THREE.Vector3(-0.62, 1.88, 1.11) },
            { id: 'h4e', el: 'H', pos: new THREE.Vector3(-1.85, 0.00, -1.11) },
            { id: 'me4a', el: 'C', pos: new THREE.Vector3(-1.25, 0.00, 1.10) },
            { id: 'me5a', el: 'C', pos: new THREE.Vector3(-0.62, -1.88, 1.11) },
            { id: 'me6a', el: 'C', pos: new THREE.Vector3(0.62, -1.88, -1.11) },
            
            // Methyl hydrogens
            { id: 'me1ah1', el: 'H', pos: new THREE.Vector3(1.75, 0.40, -1.10) },
            { id: 'me1ah2', el: 'H', pos: new THREE.Vector3(0.85, 0.40, -1.10) },
            { id: 'me1ah3', el: 'H', pos: new THREE.Vector3(1.25, -0.40, -1.40) }
        ];

        const molecule1_bonds = [
            // Ring bonds
            ['c1','c2',1], ['c2','c3',1], ['c3','c4',1], 
            ['c4','c5',1], ['c5','c6',1], ['c6','c1',1],
            
            // Substituent bonds
            ['c1','h1e',1], ['c1','me1a',1], 
            ['c2','me2a',1], ['c3','me3a',1],
            ['c4','h4e',1], ['c4','me4a',1], 
            ['c5','me5a',1], ['c6','me6a',1],
            
            // Methyl hydrogens
            ['me1a','me1ah1',1], ['me1a','me1ah2',1], ['me1a','me1ah3',1]
        ];

        const molecule2_atoms = [
            // Ring carbons
            { id: 'c1', el: 'C', pos: new THREE.Vector3(1.25, 0.00, 0.41) },
            { id: 'c2', el: 'C', pos: new THREE.Vector3(0.62, 1.08, -0.41) },
            { id: 'c3', el: 'C', pos: new THREE.Vector3(-0.62, 1.08, 0.41) },
            { id: 'c4', el: 'C', pos: new THREE.Vector3(-1.25, 0.00, -0.41) },
            { id: 'c5', el: 'C', pos: new THREE.Vector3(-0.62, -1.08, 0.41) },
            { id: 'c6', el: 'C', pos: new THREE.Vector3(0.62, -1.08, -0.41) },
            
            // Methylidene groups
            { id: 'c1exo', el: 'C', pos: new THREE.Vector3(2.45, 0.00, 0.81) },
            { id: 'h1exo1', el: 'H', pos: new THREE.Vector3(2.95, 0.87, 0.81) },
            { id: 'h1exo2', el: 'H', pos: new THREE.Vector3(2.95, -0.87, 0.81) },
            { id: 'c4exo', el: 'C', pos: new THREE.Vector3(-2.45, 0.00, -0.81) },
            { id: 'h4exo1', el: 'H', pos: new THREE.Vector3(-2.95, 0.87, -0.81) },
            { id: 'h4exo2', el: 'H', pos: new THREE.Vector3(-2.95, -0.87, -0.81) },
            
            // Methyl groups
            { id: 'me2e', el: 'C', pos: new THREE.Vector3(1.02, 2.08, -0.81) },
            { id: 'me3e', el: 'C', pos: new THREE.Vector3(-1.02, 2.08, 0.81) },
            { id: 'me5e', el: 'C', pos: new THREE.Vector3(-1.02, -2.08, 0.81) },
            { id: 'me6e', el: 'C', pos: new THREE.Vector3(1.02, -2.08, -0.81) }
        ];

        const molecule2_bonds = [
            // Ring bonds
            ['c1','c2',1], ['c2','c3',1], ['c3','c4',1], 
            ['c4','c5',1], ['c5','c6',1], ['c6','c1',1],
            
            // Methylidene bonds
            ['c1','c1exo',2], ['c1exo','h1exo1',1], ['c1exo','h1exo2',1],
            ['c4','c4exo',2], ['c4exo','h4exo1',1], ['c4exo','h4exo2',1],
            
            // Methyl bonds
            ['c2','me2e',1], ['c3','me3e',1], 
            ['c5','me5e',1], ['c6','me6e',1]
        ];

        // --- Scene Initialization Function ---
        function initViewer(containerId, atomData, bondData) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Clear previous canvas if any
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }

            const width = container.clientWidth;
            const height = container.clientHeight;

            // Create scene
            const scene = new THREE.Scene();
            //green bg
            scene.background = new THREE.Color(0x00ff00);

            // Create camera
            const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 100);
            camera.position.set(0, 0, 8);
            camera.lookAt(0, 0, 0);

            // Create renderer
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            container.appendChild(renderer.domElement);

            // Add lights
            const ambientLight = new THREE.AmbientLight(0xcccccc, 1.0);
            scene.add(ambientLight);
            
            const pointLight1 = new THREE.PointLight(0xffffff, 0.8, 100);
            pointLight1.position.set(10, 10, 10);
            scene.add(pointLight1);
            
            const pointLight2 = new THREE.PointLight(0xffffff, 0.5, 100);
            pointLight2.position.set(-10, -10, -10);
            scene.add(pointLight2);

            // Create atoms
            const atoms = {};
            atomData.forEach(data => {
                const atomMesh = createAtomMesh(data.el, data.pos);
                scene.add(atomMesh);
                atoms[data.id] = { mesh: atomMesh, pos: data.pos };
            });

            // Create bonds
            bondData.forEach(data => {
                const atom1 = atoms[data[0]];
                const atom2 = atoms[data[1]];
                const order = data[2] || 1;

                if (atom1 && atom2) {
                    const bondMesh = createBondMesh(atom1.pos, atom2.pos, order);
                    scene.add(bondMesh);
                }
            });

            // Add controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = true;
            controls.minDistance = 1;
            controls.maxDistance = 50;
            controls.target.set(0, 0, 0);

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();

            // Handle window resize
            window.addEventListener('resize', () => {
                const newWidth = container.clientWidth;
                const newHeight = container.clientHeight;
                camera.aspect = newWidth / newHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(newWidth, newHeight);
            });
        }

        // --- Initialize Viewers ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check if Three.js is loaded
            if (typeof THREE === 'undefined') {
                alert("Three.js library not loaded! Please check your internet connection.");
                return;
            }
            
            // Check if OrbitControls is loaded
            if (typeof THREE.OrbitControls === 'undefined') {
                alert("OrbitControls not loaded! Please check the script tag for OrbitControls.");
                return;
            }

            // Initialize viewers
            initViewer('viewer1_canvas_container', molecule1_atoms, molecule1_bonds);
            initViewer('viewer2_canvas_container', molecule2_atoms, molecule2_bonds);
        });
    </script>
</body>
</html>
